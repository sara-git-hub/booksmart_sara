{% extends "base.html" %}

{% block title %}Home{% endblock %}

{% block content %}
<div class="container mx-auto p-4">
  <h1 class="text-3xl font-bold mb-6">Livres disponibles</h1>

  <div class="grid grid-cols-4 gap-6">
    {% for livre in livres %}
    <div class="bg-white p-4 rounded shadow hover:shadow-lg transition relative">

        <!-- Image cliquable -->
        <a href="/api/livre/{{ livre.id }}">
            <img src="{{ livre.image_url }}" alt="{{ livre.titre }}" class="w-full h-64 object-cover mb-2 rounded">
        </a>

        <!-- Titre cliquable -->
        <h2 class="text-lg font-semibold mb-2 truncate w-full overflow-hidden whitespace-nowrap" title="{{ livre.titre }}">
            <a href="/api/livre/{{ livre.id }}" class="hover:underline">
                {{ livre.titre }}
            </a>
        </h2>

        <p class="mb-1"><span class="font-medium">Rating:</span> {{ livre.rating }}</p>
        <p class="mb-1"><span class="font-medium">Prix:</span> {{ livre.prix }} €</p>
        <p class="mb-1">
            <span class="font-medium">Statut:</span>
            {% if livre.stock > 0 %}
                <span class="text-green-600 font-semibold">Disponible</span>
            {% else %}
                <span class="text-red-600 font-semibold">Réservé</span>
            {% endif %}
        </p>

        <!-- Bouton réserver si disponible -->
        {% if livre.stock > 0 %}
        <form action="/api/reservations" method="post" class="mt-2">
            <input type="hidden" name="id_livre" value="{{ livre.id }}">
            <!-- id_adherent n'est plus nécessaire ici, backend récupère via get_current_user -->
            <button type="submit" class="bg-blue-600 text-white px-3 py-1 rounded text-sm">
                Réserver
            </button>
        </form>
        {% endif %}

    </div>
    {% endfor %}
  </div>
</div>
{% endblock %}
